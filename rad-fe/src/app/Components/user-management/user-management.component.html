<div class="user-management-container" *transloco="let t">
  <mat-toolbar color="primary" class="user-toolbar">
    <span>{{ t("users.title") }}</span>
    <span class="spacer"></span>

    <mat-form-field appearance="outline" class="filter-field">
      <mat-label>{{ t("users.filter_role") }}</mat-label>
      <mat-select
        [(ngModel)]="filterRole"
        (selectionChange)="onRoleFilterChange()"
      >
        @for (option of roleOptions; track option.value) {
          <mat-option [value]="option.value">{{ t(option.label) }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" class="filter-field">
      <mat-label>{{ t("users.filter_status") }}</mat-label>
      <mat-select
        [(ngModel)]="filterStatus"
        (selectionChange)="onStatusFilterChange()"
      >
        @for (option of statusOptions; track option.value) {
          <mat-option [value]="option.value">{{ t(option.label) }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <button
      mat-icon-button
      color="accent"
      (click)="onCreate()"
      aria-label="Create user"
    >
      <mat-icon>person_add</mat-icon>
    </button>

    <mat-form-field appearance="outline" class="search-field">
      <mat-label>{{ t("users.search") }}</mat-label>
      <input
        matInput
        type="text"
        [value]="searchText"
        (input)="onSearchChange($event)"
        placeholder="{{ t('users.search_placeholder') }}"
      />
    </mat-form-field>
  </mat-toolbar>

  <div class="user-list">
    <table mat-table [dataSource]="filteredUsers" class="mat-elevation-z1">
      <!-- Email -->
      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef>{{ t("users.email") }}</th>
        <td mat-cell *matCellDef="let user">{{ user.email }}</td>
      </ng-container>

      <!-- Full Name -->
      <ng-container matColumnDef="fullName">
        <th mat-header-cell *matHeaderCellDef>{{ t("users.fullName") }}</th>
        <td mat-cell *matCellDef="let user">{{ user.fullName || "-" }}</td>
      </ng-container>

      <!-- Role -->
      <ng-container matColumnDef="role">
        <th mat-header-cell *matHeaderCellDef>{{ t("users.role") }}</th>
        <td mat-cell *matCellDef="let user">
          <mat-chip
            [color]="
              user.role === 'super_user'
                ? 'warn'
                : user.role === 'admin'
                  ? 'accent'
                  : 'primary'
            "
            selected
          >
            {{ t(getRoleLabel(user.role)) }}
          </mat-chip>
        </td>
      </ng-container>

      <!-- Departments -->
      <ng-container matColumnDef="departments">
        <th mat-header-cell *matHeaderCellDef>{{ t("users.departments") }}</th>
        <td mat-cell *matCellDef="let user">{{ user.departments || "-" }}</td>
      </ng-container>

      <!-- Status -->
      <ng-container matColumnDef="disabled">
        <th mat-header-cell *matHeaderCellDef>{{ t("users.status") }}</th>
        <td mat-cell *matCellDef="let user">
          <mat-chip [color]="user.disabled ? 'warn' : 'primary'" selected>
            {{ user.disabled ? t("users.disabled") : t("users.active") }}
          </mat-chip>
        </td>
      </ng-container>

      <!-- Actions -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>{{ t("users.actions") }}</th>
        <td mat-cell *matCellDef="let user">
          <tc-action-buttons
            [buttons]="showActionButtons(user)"
            (action)="onActionClick($event, user)"
          >
          </tc-action-buttons>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    @if (!filteredUsers.length && !isLoading) {
      <div class="empty-list">
        <mat-icon>people_outline</mat-icon>
        <span>{{ t("users.no_users") }}</span>
      </div>
    }
  </div>
</div>
